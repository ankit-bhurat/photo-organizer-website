---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Footer from '../components/Footer.astro';

const faqs = [
  {
    question: 'When will CullVue launch?',
    answer: "We're currently in beta. Join the waitlist to get early access.",
  },
  {
    question: 'Is it really free to try?',
    answer: 'Yes, 14-day free trial with full functionality. No credit card required.',
  },
  {
    question: 'What platforms are supported?',
    answer: 'macOS (Apple Silicon & Intel), Windows, and Linux.',
  },
  {
    question: 'How does the AI search work offline?',
    answer: 'We use MobileCLIP-S2, running entirely on your device. No internet needed.',
  },
];

const highlights = [
  {
    icon: 'search',
    title: 'AI Search',
    subtitle: '100% offline',
    description: 'Find any photo by describing it in plain language. Runs on-device with zero cloud dependency.',
    gradient: 'from-brand-400 to-accent-cyan',
  },
  {
    icon: 'shield',
    title: 'Fully Private',
    subtitle: 'No cloud, ever',
    description: 'Your photos never leave your device. No uploads, no tracking, no third-party access.',
    gradient: 'from-accent-green to-accent-cyan',
  },
  {
    icon: 'devices',
    title: 'Cross-Platform',
    subtitle: 'Mac, Windows, Linux',
    description: 'One app, every desktop. Native performance on macOS, Windows, and Linux.',
    gradient: 'from-accent-purple to-brand-400',
  },
  {
    icon: 'tag',
    title: 'One-Time Purchase',
    subtitle: 'No subscription',
    description: "Pay once, own it forever. No recurring fees, no feature gating, no surprises.",
    gradient: 'from-accent-pink to-accent-purple',
  },
];
---

<Layout title="Join the Waitlist | CullVue" description="Be the first to try CullVue. AI-powered local photo management with offline semantic search. Join the waitlist for early access.">
  <Navbar />

  <main>
    <!-- ============================================ -->
    <!-- HERO + SIGNUP FORM                           -->
    <!-- ============================================ -->
    <section class="relative overflow-hidden section-spacing pb-16 md:pb-20">
      <!-- Background glow -->
      <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
        <div class="absolute top-[-20%] left-1/2 -translate-x-1/2 w-[800px] h-[600px] rounded-full bg-brand-600/[0.07] blur-[120px]"></div>
        <div class="absolute top-[10%] right-[10%] w-[400px] h-[400px] rounded-full bg-accent-purple/[0.04] blur-[100px]"></div>
      </div>

      <div class="container-narrow relative z-10">
        <!-- Eyebrow badge -->
        <div class="flex justify-center mb-8 animate-fade-in">
          <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full border border-brand-500/20 bg-brand-950/40 backdrop-blur-sm">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-accent-green opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-accent-green"></span>
            </span>
            <span class="text-sm font-medium text-brand-300">Beta coming soon</span>
          </div>
        </div>

        <!-- Headline -->
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-center leading-[1.1] tracking-tight mb-6 animate-slide-up">
          Be the first to try<br />
          <span class="gradient-text">CullVue</span>
        </h1>

        <!-- Subhead -->
        <p class="text-lg md:text-xl text-surface-400 text-center max-w-2xl mx-auto mb-12 animate-slide-up" style="animation-delay: 0.1s;">
          AI-powered photo search that runs entirely on your device.
          No cloud. No subscriptions. Just your photos, organized beautifully.
        </p>

        <!-- ---- SIGNUP FORM ---- -->
        <div class="max-w-xl mx-auto animate-slide-up" style="animation-delay: 0.2s;">
          <form
            class="relative p-1 rounded-2xl bg-gradient-to-b from-brand-500/20 via-surface-800/30 to-surface-800/20"
            id="waitlist-form"
            novalidate
          >
            <div class="bg-surface-950/90 backdrop-blur-xl rounded-[14px] p-6 sm:p-8">
              <div class="space-y-4">
                <!-- Name field -->
                <div>
                  <label for="name" class="block text-sm font-medium text-surface-300 mb-2">
                    First name
                  </label>
                  <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    autocomplete="given-name"
                    placeholder="Jane"
                    class="w-full h-12 px-4 rounded-xl
                           bg-surface-900/80 border border-surface-700/60
                           text-[15px] text-white placeholder:text-surface-600
                           focus:outline-none focus:border-brand-500/60 focus:ring-2 focus:ring-brand-500/20
                           transition-all duration-200"
                  />
                </div>

                <!-- Email field -->
                <div>
                  <label for="email" class="block text-sm font-medium text-surface-300 mb-2">
                    Email address
                  </label>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    required
                    autocomplete="email"
                    placeholder="jane@example.com"
                    class="w-full h-12 px-4 rounded-xl
                           bg-surface-900/80 border border-surface-700/60
                           text-[15px] text-white placeholder:text-surface-600
                           focus:outline-none focus:border-brand-500/60 focus:ring-2 focus:ring-brand-500/20
                           transition-all duration-200"
                  />
                </div>

                <!-- Submit -->
                <button
                  type="submit"
                  class="w-full h-12 mt-2 rounded-xl
                         bg-brand-600 text-[15px] font-semibold text-white
                         hover:bg-brand-500 active:bg-brand-700
                         transition-all duration-200
                         shadow-lg shadow-brand-600/25 hover:shadow-brand-500/35
                         focus:outline-none focus:ring-2 focus:ring-brand-500/40 focus:ring-offset-2 focus:ring-offset-surface-950
                         flex items-center justify-center gap-2"
                >
                  Join the Waitlist
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14M12 5l7 7-7 7" />
                  </svg>
                </button>

                <!-- Validation error message -->
                <p id="waitlist-error" class="hidden text-xs text-red-400 text-center mt-3"></p>
              </div>

              <!-- Trust note -->
              <p class="text-xs text-surface-500 text-center mt-5 flex items-center justify-center gap-1.5">
                <svg class="w-3.5 h-3.5 text-surface-600 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
                We'll notify you when we launch. No spam, ever.
              </p>
            </div>
          </form>

          <!-- Success state (hidden by default) -->
          <div id="waitlist-success" class="hidden max-w-xl mx-auto">
            <div class="relative p-1 rounded-2xl bg-gradient-to-b from-accent-green/20 via-surface-800/30 to-surface-800/20">
              <div class="bg-surface-950/90 backdrop-blur-xl rounded-[14px] p-8 sm:p-10 text-center">
                <div class="w-14 h-14 mx-auto mb-5 rounded-full bg-accent-green/10 border border-accent-green/20 flex items-center justify-center">
                  <svg class="w-7 h-7 text-accent-green" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 6L9 17l-5-5" />
                  </svg>
                </div>
                <h3 class="text-xl font-semibold text-white mb-2" id="waitlist-success-title">You're on the list!</h3>
                <p class="text-surface-400 text-[15px]" id="waitlist-success-text">
                  We'll notify you when CullVue launches. Check your inbox for a confirmation.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- SOCIAL PROOF                                 -->
    <!-- ============================================ -->
    <section class="py-10 md:py-14">
      <div class="container-narrow">
        <div class="flex flex-col sm:flex-row items-center justify-center gap-6 sm:gap-10">
          <!-- Waitlist count -->
          <div class="flex items-center gap-3">
            <div class="flex -space-x-2">
              {[...Array(4)].map((_, i) => (
                <div
                  class:list={[
                    'w-8 h-8 rounded-full border-2 border-surface-950 flex items-center justify-center text-[10px] font-bold text-white',
                    i === 0 && 'bg-brand-600',
                    i === 1 && 'bg-accent-purple',
                    i === 2 && 'bg-accent-cyan',
                    i === 3 && 'bg-accent-pink',
                  ]}
                >
                  {['J', 'M', 'A', 'K'][i]}
                </div>
              ))}
            </div>
            <p class="text-sm text-surface-300">
              <span class="font-semibold text-white">500+</span> photographers on the waitlist
            </p>
          </div>

          <!-- Separator -->
          <div class="hidden sm:block w-px h-6 bg-surface-800"></div>

          <!-- Trust badge -->
          <div class="flex items-center gap-2 text-sm text-surface-400">
            <svg class="w-4 h-4 text-accent-green" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
            </svg>
            Privacy-first. Always.
          </div>
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- PRODUCT HIGHLIGHTS GRID                      -->
    <!-- ============================================ -->
    <section class="section-spacing">
      <div class="container-narrow">
        <div class="text-center mb-14">
          <h2 class="text-3xl sm:text-4xl font-bold mb-4">
            Why photographers are <span class="gradient-text-warm">switching</span>
          </h2>
          <p class="text-surface-400 text-lg max-w-xl mx-auto">
            CullVue is built around one idea: your photos belong to you.
          </p>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
          {highlights.map((item) => (
            <div class="card-hover group p-6 sm:p-7">
              <!-- Icon -->
              <div class={`w-11 h-11 rounded-xl bg-gradient-to-br ${item.gradient} flex items-center justify-center mb-5 shadow-lg opacity-90 group-hover:opacity-100 transition-opacity duration-300`}>
                {item.icon === 'search' && (
                  <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8" />
                    <line x1="21" y1="21" x2="16.65" y2="16.65" />
                  </svg>
                )}
                {item.icon === 'shield' && (
                  <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                  </svg>
                )}
                {item.icon === 'devices' && (
                  <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                    <line x1="8" y1="21" x2="16" y2="21" />
                    <line x1="12" y1="17" x2="12" y2="21" />
                  </svg>
                )}
                {item.icon === 'tag' && (
                  <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" />
                    <line x1="7" y1="7" x2="7.01" y2="7" />
                  </svg>
                )}
              </div>

              <!-- Text -->
              <h3 class="text-lg font-semibold text-white mb-1">{item.title}</h3>
              <p class={`text-xs font-medium bg-gradient-to-r ${item.gradient} bg-clip-text text-transparent mb-3`}>
                {item.subtitle}
              </p>
              <p class="text-sm text-surface-400 leading-relaxed">{item.description}</p>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- FAQ SECTION                                  -->
    <!-- ============================================ -->
    <section class="section-spacing pt-8 md:pt-12">
      <div class="container-narrow max-w-3xl">
        <div class="text-center mb-14">
          <h2 class="text-3xl sm:text-4xl font-bold mb-4">
            Frequently asked questions
          </h2>
          <p class="text-surface-400 text-lg">
            Everything you need to know before joining.
          </p>
        </div>

        <div class="space-y-3" id="faq-list">
          {faqs.map((faq, index) => (
            <div class="faq-item card overflow-hidden" data-index={index}>
              <button
                type="button"
                class="w-full flex items-center justify-between gap-4 p-5 sm:p-6 text-left cursor-pointer
                       hover:bg-surface-800/30 transition-colors duration-200"
                aria-expanded="false"
              >
                <span class="text-[15px] font-medium text-white">{faq.question}</span>
                <svg
                  class="faq-chevron w-5 h-5 text-surface-500 shrink-0 transition-transform duration-300"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="6 9 12 15 18 9" />
                </svg>
              </button>
              <div class="faq-answer overflow-hidden transition-all duration-300" style="max-height: 0;">
                <p class="px-5 sm:px-6 pb-5 sm:pb-6 text-sm text-surface-400 leading-relaxed">
                  {faq.answer}
                </p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- ============================================ -->
    <!-- BOTTOM CTA                                   -->
    <!-- ============================================ -->
    <section class="section-spacing">
      <div class="container-narrow text-center">
        <div class="relative">
          <!-- Glow behind the block -->
          <div class="absolute inset-0 -z-10 flex items-center justify-center pointer-events-none" aria-hidden="true">
            <div class="w-[500px] h-[300px] rounded-full bg-brand-600/[0.06] blur-[100px]"></div>
          </div>

          <p class="text-xs font-semibold uppercase tracking-widest text-brand-400 mb-4">
            Ready to get organized?
          </p>
          <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold mb-5">
            Your photos deserve <span class="gradient-text">better</span>
          </h2>
          <p class="text-surface-400 text-lg max-w-lg mx-auto mb-10">
            Stop scrolling endlessly. Let AI find exactly the photo you need,
            without ever leaving your device.
          </p>

          <a
            href="#"
            class="btn-primary text-base px-8 py-3.5"
            onclick="document.getElementById('name')?.focus(); window.scrollTo({ top: 0, behavior: 'smooth' }); return false;"
          >
            Join the Waitlist
          </a>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<style>
  /* FAQ chevron rotation when open */
  .faq-item.open .faq-chevron {
    transform: rotate(180deg);
  }

  /* Form input autofill styling to match dark theme */
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus {
    -webkit-box-shadow: 0 0 0px 1000px rgba(14, 14, 20, 0.9) inset;
    -webkit-text-fill-color: #ffffff;
    caret-color: #ffffff;
    transition: background-color 5000s ease-in-out 0s;
  }
</style>

<script>
  function setupWaitlistPage() {
    // ---- FAQ accordion ----
    const faqItems = document.querySelectorAll('.faq-item');

    faqItems.forEach((item) => {
      const button = item.querySelector('button');
      const answer = item.querySelector('.faq-answer') as HTMLElement | null;

      if (!button || !answer) return;

      button.addEventListener('click', () => {
        const isOpen = item.classList.contains('open');

        // Close all
        faqItems.forEach((other) => {
          other.classList.remove('open');
          const otherBtn = other.querySelector('button');
          const otherAnswer = other.querySelector('.faq-answer') as HTMLElement | null;
          if (otherBtn) otherBtn.setAttribute('aria-expanded', 'false');
          if (otherAnswer) otherAnswer.style.maxHeight = '0';
        });

        // Toggle current
        if (!isOpen) {
          item.classList.add('open');
          button.setAttribute('aria-expanded', 'true');
          answer.style.maxHeight = answer.scrollHeight + 'px';
        }
      });
    });

    // ---- Waitlist form submission ----
    const form = document.getElementById('waitlist-form') as HTMLFormElement | null;
    const successEl = document.getElementById('waitlist-success');
    const errorEl = document.getElementById('waitlist-error');
    const successTitle = document.getElementById('waitlist-success-title');
    const successText = document.getElementById('waitlist-success-text');

    if (!form || !successEl || !errorEl) return;

    // Check if user already signed up (returning visitor)
    const alreadySignedUp = localStorage.getItem('waitlist-signed-up');
    if (alreadySignedUp) {
      form.style.display = 'none';
      successEl.classList.remove('hidden');
      if (successTitle) successTitle.textContent = 'You\'re already on the list!';
      if (successText) successText.textContent = 'We\'ll notify you when CullVue launches. Stay tuned!';
      return;
    }

    function isValidEmail(email: string): boolean {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function showError(message: string) {
      if (!errorEl) return;
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
    }

    function hideError() {
      if (!errorEl) return;
      errorEl.textContent = '';
      errorEl.classList.add('hidden');
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      hideError();

      const nameInput = form.querySelector('#name') as HTMLInputElement | null;
      const emailInput = form.querySelector('#email') as HTMLInputElement | null;

      if (!nameInput || !emailInput) return;

      const name = nameInput.value.trim();
      const email = emailInput.value.trim();

      // Validate name
      if (!name) {
        showError('Please enter your first name.');
        nameInput.focus();
        return;
      }

      // Validate email
      if (!email) {
        showError('Please enter your email address.');
        emailInput.focus();
        return;
      }

      if (!isValidEmail(email)) {
        showError('Please enter a valid email address.');
        emailInput.focus();
        return;
      }

      // TODO: Replace with real API endpoint (Formspree, Mailchimp, etc.)
      // Example:
      // fetch('https://your-api.com/waitlist', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify({ name, email }),
      // });

      // Store signup in localStorage so returning visitors see the "already signed up" state
      localStorage.setItem('waitlist-signed-up', JSON.stringify({ name, email, date: new Date().toISOString() }));

      // Show success state
      form.style.display = 'none';
      successEl.classList.remove('hidden');
      successEl.classList.add('animate-scale-in');
    });
  }

  // Support Astro view transitions
  document.addEventListener('astro:page-load', setupWaitlistPage);

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', setupWaitlistPage);
  } else {
    setupWaitlistPage();
  }
</script>
